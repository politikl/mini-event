<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Edit Tree - DecomyTree</title>
    <link rel="stylesheet" href="decomytree.css">
    <link rel="stylesheet" href="decomytree_view.css">
</head>
<body>
    <div class="background-trees"></div>
    <div class="celestial-body sun"></div>
    <div id="auth-container">
        <div id="user-info" class="hidden">
            <span id="username-display"></span>
            <button id="sign-out-btn">Sign Out</button>
        </div>
    </div>

    <main class="container">
        <div class="view-header">
            <button id="back-btn" class="back-btn">‚Üê Back</button>
            <h1>Edit Your Tree</h1>
        </div>

        <div class="edit-panel panel">
            <label>Tree Style:</label>
            <div class="designs">
                <label><input type="radio" name="design" value="classic"> <span>üéÑ Classic</span></label>
                <label><input type="radio" name="design" value="modern"> <span>‚ú® Modern</span></label>
                <label><input type="radio" name="design" value="snowy"> <span>‚ùÑÔ∏è Snowy</span></label>
            </div>

            <label>Tree Color:</label>
            <div class="designs">
                <label><input type="radio" name="color" value="green"> <span>üü¢ Green</span></label>
                <label><input type="radio" name="color" value="blue"> <span>üîµ Blue</span></label>
                <label><input type="radio" name="color" value="frost"> <span>‚ùÑÔ∏è Frost</span></label>
                <label><input type="radio" name="color" value="emerald"> <span>üíö Emerald</span></label>
                <label><input type="radio" name="color" value="midnight"> <span>üåå Midnight</span></label>
            </div>

            <label style="margin-top:12px">Scene Theme:</label>
            <div class="designs">
                <label><input type="radio" name="theme" value="scene-default"> <span>Classic</span></label>
                <label><input type="radio" name="theme" value="scene-colorful"> <span>Colorful</span></label>
                <label><input type="radio" name="theme" value="scene-snowy"> <span>Snowy</span></label>
            </div>

            <label style="margin-top:16px"><input type="checkbox" id="tree-public"> Make this tree <strong>public</strong></label>

            <div class="modal-buttons" style="margin-top:20px">
                <button id="save-tree-btn" class="primary">Save Changes</button>
                <button id="share-tree-btn" class="primary" style="margin-left:8px">üîó Share Tree</button>
                <button id="back-to-view" class="cancel">Cancel</button>
            </div>
        </div>
    </main>

    <!-- Share Tree Modal -->
    <div id="share-modal" class="modal hidden">
        <div class="modal-content">
            <h2>Share Your Tree</h2>
            <p>Add friends to your private tree by their username (e.g. <em>First L</em>) or by email. Use usernames to invite without exposing emails.</p>
            
            <label>Friend's Username or Email:
                <input type="text" id="share-email" placeholder="First L or friend@lakesideschool.org" style="width:100%;padding:8px;margin:8px 0;border-radius:6px;border:1px solid rgba(212,175,55,0.3);background:rgba(255,255,255,0.05);color:var(--cream)">
            </label>

            <div id="invited-users" style="margin-top:16px">
                <h3 style="color:var(--gold);margin-bottom:8px">Invited Users:</h3>
                <div id="invited-list" style="max-height:200px;overflow-y:auto"></div>
            </div>

            <div class="modal-buttons" style="margin-top:20px">
                <button id="add-user-btn" class="primary">Add User</button>
                <button id="close-share-btn" class="cancel">Close</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-analytics.js";
        import { 
            getAuth, 
            GoogleAuthProvider, 
            signInWithPopup, 
            signOut, 
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            setDoc, 
            getDoc, 
            updateDoc,
            serverTimestamp,
            arrayUnion,
            arrayRemove,
            collection,
            query,
            where,
            getDocs
        } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyARY96nrH2Aio8rOiLkewSXtTS40TZLrAw",
            authDomain: "nerd-mini-events.firebaseapp.com",
            projectId: "nerd-mini-events",
            storageBucket: "nerd-mini-events.firebasestorage.app",
            messagingSenderId: "974357416633",
            appId: "1:974357416633:web:e190de60553d03e968",
            measurementId: "G-V9NGCSEY8J"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseSignOut = signOut;
        window.firebaseOnAuthStateChanged = onAuthStateChanged;
        window.firebaseDoc = doc;
        window.firebaseGetDoc = getDoc;
        window.firebaseUpdateDoc = updateDoc;
        window.firebaseServerTimestamp = serverTimestamp;
        window.firebaseArrayUnion = arrayUnion;
        window.firebaseArrayRemove = arrayRemove;
        window.firebaseCollection = collection;
        window.firebaseQuery = query;
        window.firebaseWhere = where;
        window.firebaseGetDocs = getDocs;

        window.firebaseReady = true;
        if (window.initEditTree) window.initEditTree();
    </script>

    <script src="decomytree_edit.js"></script>
</body>
</html>
